<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Raspberry Pi setup | CNC Fly Food Dispenser</title>
  <meta name="description" content="Manual for CNC Fly Food Dispenser" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Raspberry Pi setup | CNC Fly Food Dispenser" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/images/system.jpg" />
  <meta property="og:description" content="Manual for CNC Fly Food Dispenser" />
  <meta name="github-repo" content="waylandm/fly-food-robot" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Raspberry Pi setup | CNC Fly Food Dispenser" />
  
  <meta name="twitter:description" content="Manual for CNC Fly Food Dispenser" />
  <meta name="twitter:image" content="/images/system.jpg" />

<meta name="author" content="Matt Wayland" />


<meta name="date" content="2024-01-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="grbl.html"/>
<link rel="next" href="startup.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>



<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Fly Food Robot</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#github"><i class="fa fa-check"></i>Github</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contact"><i class="fa fa-check"></i>Contact</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#publication"><i class="fa fa-check"></i>Publication</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#colophon"><i class="fa fa-check"></i>Colophon</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="grbl.html"><a href="grbl.html"><i class="fa fa-check"></i><b>2</b> Grbl installation and configuration</a>
<ul>
<li class="chapter" data-level="2.1" data-path="grbl.html"><a href="grbl.html#overview"><i class="fa fa-check"></i><b>2.1</b> Overview</a></li>
<li class="chapter" data-level="2.2" data-path="grbl.html"><a href="grbl.html#flashing-grbl-to-arduino"><i class="fa fa-check"></i><b>2.2</b> Flashing Grbl to Arduino</a></li>
<li class="chapter" data-level="2.3" data-path="grbl.html"><a href="grbl.html#check-serial-connection-to-grbl"><i class="fa fa-check"></i><b>2.3</b> Check serial connection to Grbl</a></li>
<li class="chapter" data-level="2.4" data-path="grbl.html"><a href="grbl.html#grbl-configuration"><i class="fa fa-check"></i><b>2.4</b> Grbl configuration</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="grbl.html"><a href="grbl.html#read-current-configuration"><i class="fa fa-check"></i><b>2.4.1</b> Read current configuration</a></li>
<li class="chapter" data-level="2.4.2" data-path="grbl.html"><a href="grbl.html#check-directionality-of-each-axis."><i class="fa fa-check"></i><b>2.4.2</b> Check directionality of each axis.</a></li>
<li class="chapter" data-level="2.4.3" data-path="grbl.html"><a href="grbl.html#activate-hard-limits"><i class="fa fa-check"></i><b>2.4.3</b> Activate hard limits</a></li>
<li class="chapter" data-level="2.4.4" data-path="grbl.html"><a href="grbl.html#setup-homing"><i class="fa fa-check"></i><b>2.4.4</b> Setup homing</a></li>
<li class="chapter" data-level="2.4.5" data-path="grbl.html"><a href="grbl.html#motor-step-size"><i class="fa fa-check"></i><b>2.4.5</b> Motor step size</a></li>
<li class="chapter" data-level="2.4.6" data-path="grbl.html"><a href="grbl.html#feed-rates-and-acceleration"><i class="fa fa-check"></i><b>2.4.6</b> Feed rates and acceleration</a></li>
<li class="chapter" data-level="2.4.7" data-path="grbl.html"><a href="grbl.html#summary-of-settings"><i class="fa fa-check"></i><b>2.4.7</b> Summary of settings</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="grbl.html"><a href="grbl.html#setting-motor-current"><i class="fa fa-check"></i><b>2.5</b> Setting motor current</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="raspi.html"><a href="raspi.html"><i class="fa fa-check"></i><b>3</b> Raspberry Pi setup</a>
<ul>
<li class="chapter" data-level="3.1" data-path="raspi.html"><a href="raspi.html#overview-1"><i class="fa fa-check"></i><b>3.1</b> Overview</a></li>
<li class="chapter" data-level="3.2" data-path="raspi.html"><a href="raspi.html#install-image"><i class="fa fa-check"></i><b>3.2</b> Install image</a></li>
<li class="chapter" data-level="3.3" data-path="raspi.html"><a href="raspi.html#network-configuration"><i class="fa fa-check"></i><b>3.3</b> Network configuration</a></li>
<li class="chapter" data-level="3.4" data-path="raspi.html"><a href="raspi.html#install-minicom"><i class="fa fa-check"></i><b>3.4</b> Install minicom</a></li>
<li class="chapter" data-level="3.5" data-path="raspi.html"><a href="raspi.html#expand-filesystem"><i class="fa fa-check"></i><b>3.5</b> Expand filesystem</a></li>
<li class="chapter" data-level="3.6" data-path="raspi.html"><a href="raspi.html#installScripts"><i class="fa fa-check"></i><b>3.6</b> Install python scripts</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="startup.html"><a href="startup.html"><i class="fa fa-check"></i><b>4</b> System start-up</a>
<ul>
<li class="chapter" data-level="4.1" data-path="startup.html"><a href="startup.html#attach-norprene-tubing"><i class="fa fa-check"></i><b>4.1</b> Attach Norprene tubing</a></li>
<li class="chapter" data-level="4.2" data-path="startup.html"><a href="startup.html#switch-on-all-devices"><i class="fa fa-check"></i><b>4.2</b> Switch on all devices</a></li>
<li class="chapter" data-level="4.3" data-path="startup.html"><a href="startup.html#prime-pump"><i class="fa fa-check"></i><b>4.3</b> Prime pump</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="gcode.html"><a href="gcode.html"><i class="fa fa-check"></i><b>5</b> Program robot to fill vials</a>
<ul>
<li class="chapter" data-level="5.1" data-path="gcode.html"><a href="gcode.html#overview-2"><i class="fa fa-check"></i><b>5.1</b> Overview</a></li>
<li class="chapter" data-level="5.2" data-path="gcode.html"><a href="gcode.html#loadBoxes"><i class="fa fa-check"></i><b>5.2</b> Load boxes</a></li>
<li class="chapter" data-level="5.3" data-path="gcode.html"><a href="gcode.html#boxCoordinates"><i class="fa fa-check"></i><b>5.3</b> Determine box coordinates</a></li>
<li class="chapter" data-level="5.4" data-path="gcode.html"><a href="gcode.html#calibratePump"><i class="fa fa-check"></i><b>5.4</b> Calibrate pump</a></li>
<li class="chapter" data-level="5.5" data-path="gcode.html"><a href="gcode.html#generate-programs"><i class="fa fa-check"></i><b>5.5</b> Generate programs</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="operation.html"><a href="operation.html"><i class="fa fa-check"></i><b>6</b> Routine operation</a>
<ul>
<li class="chapter" data-level="6.1" data-path="operation.html"><a href="operation.html#prepare-system"><i class="fa fa-check"></i><b>6.1</b> Prepare system</a></li>
<li class="chapter" data-level="6.2" data-path="operation.html"><a href="operation.html#fill-boxes"><i class="fa fa-check"></i><b>6.2</b> Fill boxes</a></li>
<li class="chapter" data-level="6.3" data-path="operation.html"><a href="operation.html#shutdown"><i class="fa fa-check"></i><b>6.3</b> Shutdown</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">CNC Fly Food Dispenser</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="raspi" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> Raspberry Pi setup<a href="raspi.html#raspi" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="overview-1" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Overview<a href="raspi.html#overview-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The raspberry pi is used to generate, then stream g-code to the Arduino. A small thin-film-transistor (TFT) touchscreen serves as the user interface to the raspberry pi.</p>
</div>
<div id="install-image" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Install image<a href="raspi.html#install-image" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><del>The first step is to install Adafruit’s custom raspberry pi image on the micro SD card. The custom image is described here:</del></p>
<p><del><code>https://learn.adafruit.com/adafruit-pitft-28-inch-resistive-touchscreen-display-raspberry-pi/easy-install</code></del></p>
<p><del>We want the classic version which boots into X by default, rather then the lite version that boots to the command line. The classic version can be downloaded from this link:</del></p>
<p><del><code>https://s3.amazonaws.com/adafruit-raspberry-pi/2016-10-18-pitft-28r.zip</code></del></p>
<p>Adafruit’s custom raspberry pi image is no longer available. I have created an image (pitft.img) based on Adafruit’s original that is preconfigured for use with the robot. It can be downloaded from:</p>
<p><a href="https://zenodo.org/records/10534021" class="uri">https://zenodo.org/records/10534021</a></p>
<p>Instructions on installing images on SD cards can be found here:</p>
<p><a href="https://www.raspberrypi.org/documentation/installation/installing-images/" class="uri">https://www.raspberrypi.org/documentation/installation/installing-images/</a></p>
</div>
<div id="network-configuration" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Network configuration<a href="raspi.html#network-configuration" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The small screen of the pitft makes using most applications quite tricky. Therefore the first thing we should do after installing the image is configure networking, so that we can access the raspberry pi remotely using ssh.</p>
<p>To set a static IP address for the ethernet adapter, edit the following lines of <code>/etc/dhcpcd.conf</code>:</p>
<pre><code>interface eth0

static ip_address=192.168.1.3/24
static routers=192.168.1.254
static domain_name_servers=192.168.1.254</code></pre>
<p><strong>ip_address</strong>, <strong>routers</strong> and <strong>domain_name_servers</strong> should be set to values appropriate for your network.</p>
<p>To raspberry pi can then be accessed using ssh, <em>e.g.</em>:</p>
<pre><code>  ssh pi@192.168.1.3</code></pre>
<p>The default password for the <strong>pi</strong> user account is <strong>raspberry</strong></p>
</div>
<div id="install-minicom" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Install minicom<a href="raspi.html#install-minicom" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><em>N.B. Minicom is pre-installed on my pitft.img</em></p>
<p>Minicom is useful for manual control of the robot and for editing grbl settings.</p>
<p>To install minicom run these two commands:</p>
<pre><code>sudo apt-get update
sudo apt-get install minicom</code></pre>
<p>Before we can use minicom we need to enable serial:</p>
<pre><code>sudo nano /boot/config.txt</code></pre>
<p>Change the last line of this file from</p>
<pre><code>enable_uart=0</code></pre>
<p>to</p>
<pre><code>enable_uart=1</code></pre>
<p>If you have not already done so, reconnect the raspberry pi to the arduino using the USB cable. To use minicom to connect to the grbl controller running on the arduino, use:</p>
<pre><code>sudo minicom -D /dev/ttyACM0 -b115200</code></pre>
</div>
<div id="expand-filesystem" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Expand filesystem<a href="raspi.html#expand-filesystem" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Expand filesystem on micro SD card:</p>
<pre><code>    sudo raspi-config
    (expand filesystem)
    sudo reboot</code></pre>
</div>
<div id="installScripts" class="section level2 hasAnchor" number="3.6">
<h2><span class="header-section-number">3.6</span> Install python scripts<a href="raspi.html#installScripts" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><em>N.B. The python scripts are pre-installed on my pitft.img</em></p>
<p>Make sure you are in pi’s home directory:</p>
<pre><code>cd</code></pre>
<p>Download and unpack robot.tar.gz</p>
<pre><code>curl -O https://raw.githubusercontent.com/WaylandM/fly-food-robot/master/raspberrypi/robot.tar.gz
tar xzvf robot.tar.gz</code></pre>
<p>The <strong>robot</strong> directory contains two subdirectories: <strong>nc</strong> (g-code scripts) and <strong>py</strong> (python scripts).</p>
<p>To automatically launch the robot GUI when the raspberry pi starts up, we need to edit the autostart file for the pi user:</p>
<pre><code>sudo nano /home/pi/.config/lxsession/LXDE-pi/autostart</code></pre>
<p>Add the following line to autostart:</p>
<pre><code>@/home/pi/robot/py/fly_gui.py</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="grbl.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="startup.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/WaylandM/fly-food-robot/edit/master/03-raspi-setup.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["fly-food-robot.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
